<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick Sort Animation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f5f5f5;
        }

        h2 {
            color: #333;
        }

        input {
            padding: 8px;
            font-size: 16px;
            margin: 10px;
            width: 300px;
        }

        button {
            padding: 10px 15px;
            font-size: 16px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            margin: 5px;
        }

        button:hover {
            background-color: #0056b3;
        }

        .container {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            height: 300px;
            margin-top: 20px;
            gap: 5px;
        }

        .bar {
            width: 40px;
            background-color: steelblue;
            transition: 0.5s;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .bar-label {
            margin-top: 10px;
        }

        .pivot {
            background-color: red !important;
        }

        .comparing {
            background-color: yellow !important;
            color: black !important;
        }
        .togglecontainer {
            display: flex;
            flex-direction: row-reverse;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-family: sans-serif;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            display: none;
            font-weight: bold;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            background-color: #ccc;
            transition: .4s;
            height: 100%;
            width: 100%;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #2196F3;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .label {
            font-size: 18px;
            font-weight: bold;
            color: #444;
            min-width: 40px;
        }

        
    </style>
</head>
<body>

    <h2>Quick Sort Animation</h2>
    <input type="text" id="inputNumbers" placeholder="Enter numbers separated by commas">
    <br>
    <div class="togglecontainer">
        <label class="switch">
            <input type="checkbox" id="myToggle">
            <span class="slider"></span>
        </label>
        <span class="label" id="toggleState">Toggle if you want to select pivot as rightmost element and click on sort</span>
    </div>
    
    <br>
    <button onclick="startSorting()">Sort</button>

    <div class="container" id="barsContainer"></div>

    <p id="message">Staring Sorting</p>
    <script>
    let delay = 1800;
    let minVal, maxVal;
    let globalArr = [];

    function createBars(arr) {
        const container = document.getElementById("barsContainer");
        container.innerHTML = "";

        minVal = Math.min(...arr);
        maxVal = Math.max(...arr);
        const range = maxVal - minVal || 1;

        arr.forEach(num => {
            const wrapper = document.createElement("div");
            wrapper.style.display = "flex";
            wrapper.style.flexDirection = "column";
            wrapper.style.alignItems = "center";

            const bar = document.createElement("div");
            bar.classList.add("bar");
            bar.style.height = `${((num - minVal) / range) * 250 + 20}px`;
            bar.innerText = num;

            const label = document.createElement("span");
            label.classList.add("bar-label");
            label.innerText = "";

            wrapper.appendChild(bar);
            wrapper.appendChild(label);
            container.appendChild(wrapper);
        });
    }

    function delayAnimation() {
        return new Promise(resolve => setTimeout(resolve, delay));
    }

    async function updateBars() {
        const bars = document.getElementsByClassName("bar");

        for (let i = 0; i < globalArr.length; i++) {
            const range = maxVal - minVal || 1;
            bars[i].style.height = `${((globalArr[i] - minVal) / range) * 250 + 20}px`;
            bars[i].innerText = globalArr[i];
        }

        await delayAnimation();
    }

    function addLabels(pivot, left, right) {
        const wrappers = document.getElementById("barsContainer").children;
        for (let w of wrappers) {
            const bar = w.querySelector(".bar");
            w.querySelector(".bar-label").innerText = "";
            bar.classList.remove("pivot", "comparing");
        }

        if (pivot >= 0) wrappers[pivot].querySelector(".bar").classList.add("pivot");
        if (left >= 0 && left < wrappers.length) wrappers[left].querySelector(".bar").classList.add("comparing");
        if (right >= 0 && right < wrappers.length) wrappers[right].querySelector(".bar").classList.add("comparing");

        if (pivot >= 0) wrappers[pivot].querySelector(".bar-label").innerText = "Pivot";
        if (left >= 0 && left < wrappers.length) wrappers[left].querySelector(".bar-label").innerText = "Left";
        if (right >= 0 && right < wrappers.length) wrappers[right].querySelector(".bar-label").innerText = "Right";
    }

    async function partition(arr, start, end, pivotRight) {
        let pivotIndex = pivotRight ? end : start;
        let pivotValue = arr[pivotIndex];

        let left = start;
        let right = end;

        addLabels(pivotIndex, left, right);
        await delayAnimation();

        while (left <= right) {

            while (left <= end && (pivotRight ? arr[left] < pivotValue : arr[left] <= pivotValue)) {
                document.getElementById("message").innerText =
                    `Comparing LEFT: ${arr[left]} with PIVOT: ${pivotValue} → ` +
                    (pivotRight ? `${arr[left]} < ${pivotValue}` : `${arr[left]} <= ${pivotValue}`) +
                    ` (move left pointer)`;

                left++;
                addLabels(pivotIndex, left, right);
                await delayAnimation();
            }

            while (right >= start && (pivotRight ? arr[right] > pivotValue : arr[right] >= pivotValue)) {
                document.getElementById("message").innerText =
                    `Comparing RIGHT: ${arr[right]} with PIVOT: ${pivotValue} → ` +
                    (pivotRight ? `${arr[right]} > ${pivotValue}` : `${arr[right]} >= ${pivotValue}`) +
                    ` (move right pointer)`;

                right--;
                addLabels(pivotIndex, left, right);
                await delayAnimation();
            }

            if (left <= right) {
                document.getElementById("message").innerText =
                    `Swapping: LEFT ${arr[left]} ↔ RIGHT ${arr[right]}`;
                [arr[left], arr[right]] = [arr[right], arr[left]];
                await updateBars();
                left++;
                right--;
                addLabels(pivotIndex, left, right);
            }
        }

        // Swap pivot into correct position
        if (pivotRight) {
            document.getElementById("message").innerText =
                `Placing pivot. Swapping PIVOT ${pivotValue} ↔ ${arr[left]}`;
            [arr[left], arr[pivotIndex]] = [arr[pivotIndex], arr[left]];
            pivotIndex = left;
        } else {
            if (right >= start) {
                [arr[right], arr[pivotIndex]] = [arr[pivotIndex], arr[right]];
                pivotIndex = right;
            }
        }

        await updateBars();
        addLabels(pivotIndex, -1, -1);
        return pivotIndex;
    }

    async function quickSort(arr, start, end, pivotRight) {
        if (start >= end) return;

        let pivotIndex = await partition(arr, start, end, pivotRight);

        await quickSort(arr, start, pivotIndex - 1, pivotRight);
        await quickSort(arr, pivotIndex + 1, end, pivotRight);
    }

    function startSorting() {
        const toggle = document.getElementById("myToggle").checked;
        const input = document.getElementById("inputNumbers").value;

        globalArr = input
            .replace(/\s+/g, "")
            .split(",")
            .map(n => parseInt(n))
            .filter(n => !isNaN(n));

        if (globalArr.length === 0) {
            alert("Invalid input!");
            return;
        }

        createBars(globalArr);
        quickSort(globalArr, 0, globalArr.length - 1, toggle);
    }
    </script>

</body>
</html>
